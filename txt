<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ title }}</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* Optional: A simple scrollbar style for better aesthetics */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f5f9; /* slate-100 */
      }
      ::-webkit-scrollbar-thumb {
        background: #94a3b8; /* slate-400 */
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #64748b; /* slate-500 */
      }
    </style>
  </head>

  <body class="h-screen bg-slate-50 font-sans">
    <div class="flex h-screen">
      {% include 'partials/sidebar.html' %}

      <div class="flex flex-1 flex-col overflow-hidden">
        {% include 'partials/header.html' with page_title="Test Report" %}

        <main class="flex-1 overflow-x-hidden overflow-y-auto bg-slate-50">
          <div class="container mx-auto px-6 py-8">
            <header class="mb-6">
              <h2 class="text-2xl font-bold text-slate-800">
                {{ registration.question_paper.title }} Report
              </h2>
              <p class="text-sm text-slate-500 mt-1">
                Detailed report for {{ registration.email }}'s attempt on
                {{ registration.created_at | date : "F j, Y" }}.
              </p>
            </header>

            <section class="bg-white p-6 rounded-xl shadow-lg">
              <h2 class="text-lg font-semibold text-slate-800 mb-4">Summary</h2>

              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                <div class="bg-slate-100 p-4 rounded-lg">
                  <p
                    class="text-xs font-medium text-slate-500 uppercase tracking-wider"
                  >
                    Score
                  </p>
                  <p
                    class="text-3xl font-bold text-[#736b8e] tracking-tight mt-1"
                  >
                    {{ percentage }}%
                  </p>
                </div>
                <div class="bg-slate-100 p-4 rounded-lg">
                  <p
                    class="text-xs font-medium text-slate-500 uppercase tracking-wider"
                  >
                    Correct Answers
                  </p>
                  <p
                    class="text-3xl font-bold text-green-600 tracking-tight mt-1"
                  >
                    {{ score }} / {{ total_questions }}
                  </p>
                </div>
                <div class="bg-slate-100 p-4 rounded-lg">
                  <p
                    class="text-xs font-medium text-slate-500 uppercase tracking-wider"
                  >
                    Incorrect Answers
                  </p>
                  <p
                    class="text-3xl font-bold text-red-600 tracking-tight mt-1"
                  >
                    {{ incorrect_answers }} / {{ total_questions }}
                  </p>
                </div>
              </div>
            </section>

            <section class="mt-8">
              <h2 class="text-lg font-semibold text-slate-800 mb-4">
                Questions & Answers
              </h2>

              <div class="space-y-4">
                {% for result in results %}
                <div
                  class="bg-white p-5 rounded-xl shadow-md border-l-4 {% if result.is_correct %}border-green-400{% else %}border-red-400{% endif %}"
                >
                  <div class="flex justify-between items-start gap-4">
                    <p class="text-base font-semibold text-slate-800">
                      {{ forloop.counter }}. {{ result.question_text }}
                    </p>
                    {% if result.is_correct %}
                    <div
                      class="flex-shrink-0 flex items-center gap-1.5 text-green-700"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        class="w-5 h-5"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.06 0l4.001-5.498Z"
                          clip-rule="evenodd"
                        />
                      </svg>
                      <span class="font-medium text-sm">Correct</span>
                    </div>
                    {% else %}
                    <div
                      class="flex-shrink-0 flex items-center gap-1.5 text-red-700"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        class="w-5 h-5"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16ZM8.28 7.22a.75.75 0 0 0-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 1 0 1.06 1.06L10 11.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L11.06 10l1.72-1.72a.75.75 0 0 0-1.06-1.06L10 8.94 8.28 7.22Z"
                          clip-rule="evenodd"
                        />
                      </svg>
                      <span class="font-medium text-sm">Incorrect</span>
                    </div>
                    {% endif %}
                  </div>
                  <div class="mt-4 pl-1 space-y-3">
                    <div>
                      <p class="text-sm font-medium text-slate-500">
                        Your Answer:
                      </p>
                      <p class="text-slate-700 mt-0.5 text-base">
                        {{ result.user_answer | default : "(No answer)" }}
                      </p>
                    </div>
                    <div>
                      <p class="text-sm font-medium text-slate-500">
                        Correct Answer:
                      </p>
                      <p class="text-slate-800 font-semibold mt-0.5 text-base">
                        {{ result.correct_answer }}
                      </p>
                    </div>
                  </div>
                </div>
                {% empty %}
                <div
                  class="bg-yellow-50 border border-yellow-200 rounded-lg p-5 text-center text-yellow-800"
                >
                  No responses were found for this test.
                </div>
                {% endfor %}
              </div>
            </section>
          </div>
        </main>
      </div>
    </div>

    <script>
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.startsWith(name + "=")) {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }

      document.addEventListener("DOMContentLoaded", function () {
        // --- Existing Sidebar and User Menu Logic (No change) ---
        const sidebar = document.getElementById("sidebar");
        const toggleButton = document.getElementById("sidebar-toggle");
        const sidebarLogo = document.getElementById("sidebar-logo");
        const sidebarTexts = document.querySelectorAll(".sidebar-text");
        const sidebarHeader = document.getElementById("sidebar-header");

        if (toggleButton) {
          toggleButton.addEventListener("click", () => {
            sidebar.classList.toggle("w-64");
            sidebar.classList.toggle("w-20");
            sidebarLogo.classList.toggle("hidden");
            sidebarHeader.classList.toggle("justify-between");
            sidebarHeader.classList.toggle("justify-center");
            sidebarTexts.forEach((text) => {
              text.classList.toggle("hidden");
            });
          });
        }

        const userMenuButton = document.getElementById("user-menu-button");
        const userMenu = document.getElementById("user-menu");

        userMenuButton.addEventListener("click", (event) => {
          userMenu.classList.toggle("hidden");
          event.stopPropagation();
        });

        document.addEventListener("click", (event) => {
          if (
            !userMenu.classList.contains("hidden") &&
            !userMenuButton.contains(event.target)
          ) {
            userMenu.classList.add("hidden");
          }
        });
      });
    </script>
  </body>
</html>
